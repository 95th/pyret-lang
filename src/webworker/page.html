<!doctype HTML>
<html>
<head></head>

<body>

<input type="text" id="program"></input>
<button type="button" id="compile">Compile</button>

<script type="text/javascript" src="browserfs.min.js"></script>
<script>

var myWorker = new Worker('pyret.jarr');
let input = document.getElementById("program");
let compile = document.getElementById("compile");

// How to use BrowserFS with Web Workers: https://github.com/jvilk/BrowserFS/issues/210
BrowserFS.install(window);
BrowserFS.configure({
  fs: "LocalStorage"
}, function(e) {
  BrowserFS.FileSystem.WorkerFS.attachRemoteListener(myWorker);

  var headElement = document.getElementsByTagName("HEAD")[0];
  var scriptElement = document.createElement('script');
  scriptElement.type = 'text/javascript';
  scriptElement.src = "pyret-api.js";
  headElement.appendChild(scriptElement);
  
  if (e) {
    throw e;
  }
});

compile.onclick = function() {
  let message = {
    program: input.value,
    options: {
      program: "./program",
      "base-dir": "./",
      checks: "none",
    }
  };
  myWorker.postMessage(JSON.stringify(message));
  console.log('Message posted to worker');
};

myWorker.onmessage = function(e) {
  console.log("Message from worker: ", e);
};

</script>
</body>
</html>
